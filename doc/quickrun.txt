*quickrun.txt*	Run a command and show its result quickly.

Version: 0.5.0
Author: thinca <thinca+vim@gmail.com>
English documentation by:
  * ujihisa <ujihisa at gmail com>
  * tyru <tyru.exe@gmail.com>
License: Creative Commons 2.1 Japanese
	 <http://creativecommons.org/licenses/by/2.1/jp/>

==============================================================================
CONTENTS					*quickrun-contents*

INTRODUCTION			|quickrun-introduction|
INTERFACE			|quickrun-interface|
  COMMANDS			  |quickrun-commands|
  FUNCTIONS			  |quickrun-functions|
  KEY MAPPINGS			  |quickrun-key-mappings|
OPTIONS				|quickrun-options|
  OPTION SYNTAX			  |quickrun-syntax-option|
  FORMAT OF EXEC		  |quickrun-exec-format|
SETTINGS			|quickrun-settings|
MODULE				|quickrun-module|
  RUNNER			  |quickrun-module-runner|
  OUTPUTTER			  |quickrun-module-outputter|
CREATE MODULE			|quickrun-create-module|
  REGISTER MODULE		  |quickrun-register-module|
  SESSION			  |quickrun-session|
  MODULE COMMON ATTRIBUTES	  |quickrun-module-attributes|
  RUNNER ATTRIBUTES		  |quickrun-runner-attributes|
  OUTPUTTER ATTRIBUTES		  |quickrun-outputter-attributes|
CHANGELOG			|quickrun-changelog|


==============================================================================
INTRODUCTION					*quickrun-introduction*

*quickrun* is Vim plugin to execute whole/part of editing file.
It provides |:QuickRun| for it.

Requirement:
- Vim 7.2 or later

Latest Version:
http://github.com/thinca/vim-quickrun


						*quickrun-synopsis*
>
	" Execute current buffer.
	:QuickRun

	" Execute current buffer from line 3 to line 6.
	:3,6QuickRun

	" Execute current buffer as perl program.
	:QuickRun perl

	" Execute one-liner program given from command-line.
	:QuickRun ruby -src 'puts "Hello, world!"'


	" (In .vimrc) Set default program to execute haskell program to hugs.
	let g:quickrun_config = {}
	let g:quickrun_config.haskell = {'command' : 'runhugs'}

	" Set shortcut keys.
	for [key, com] in items({
	\   '<Leader>x' : '>:',
	\   '<Leader>p' : '>!',
	\   '<Leader>w' : '>',
	\   '<Leader>q' : '>>',
	\ })
		execute 'nnoremap <silent>' key ':QuickRun' com '-mode n<CR>'
		execute 'vnoremap <silent>' key ':QuickRun' com '-mode v<CR>'
	endfor
<


==============================================================================
INTERFACE					*quickrun-interface*

------------------------------------------------------------------------------
COMMANDS					*quickrun-commands*

						*:QuickRun*
:[range]QuickRun [{type}] [<{input}] [>[>][{output}]] [-option value]...
	Execute program with misc. options.
	See |quickrun-options| for supported options.
	Options are pairs of names, values like:
>
	-name value
<
	You can specify options as possible.
	All options are insensitive to the order.
	If value contains whitespaces,
	you must quote with single quote or double quote.
	And you want to specify single quote(s) or double quote(s)
	inside it, you must escape with backslash(es).

	{type} is abbreviation to -type {type}
	<{input} is abbreviation to -input {input}
	>{output} is abbreviation to -output {output}
	>>{output} is abbreviation to -append 1 -output {output}

	|:Quickrun| can take |:range|.
	if it was not given, |:QuickRun| treats whole lines.
	If you specify '<,'> and do not specify -mode
	(|quickrun-option-mode|), target is selected text in visual mode. And
	|blockwise-visual| also works.  But when |:QuickRun| is executed from
	key mapping, you need to specify -mode because |:QuickRun| can't
	detect current mode.


------------------------------------------------------------------------------
FUNCTIONS					*quickrun-functions*

quickrun#operator({wise})			*quickrun#operator()*
	A function for 'operatorfunc'.
	e.g.: >
	nnoremap <silent> <C-CR> :<C-u>set opfunc=quickrun#operator<CR>g@ip
<	This runs current paragraph (|ip|) with <C-CR>.

						*quickrun#register_module()*
quickrun#register_module({kind}, {name}, {module})
	Registers {module}. See details in |quickrun-create-module|.

quickrun#register_runner({name}, {runner})	*quickrun#register_runner()*
	An alias of quickrun#register_module("runner", {name}, {runner}).

						*quickrun#register_outputter()*
quickrun#register_outputter({name}, {outputter})
	An alias of quickrun#register_module("outputter", {name}, {outputter}).

						*quickrun#session()*
quickrun#session({key} [, {func-name} [, {args} ...]])
	This is used in a module. This fetches the current runnning session if
	you skipped {func-name}. This calls the session function with
	arguments {args} if you specified {func-name}.


------------------------------------------------------------------------------
KEY MAPPINGS					*quickrun-key-mappings*

<Plug>(quickrun-op)				*<Plug>(quickrun-op)*
			Execute next motion's range.
			This sets 'operatorfunc' to "QuickRun".

<Plug>(quickrun)				*<Plug>(quickrun)*
			Execute and display the result for current buffer.
			This is normally same as |:QuickRun|
			without arguments.
<

					*g:quickrun_no_default_key_mappings*
Following key mapings will NOT be defined if it's already mapped,
or |g:quickrun_no_default_key_mappings| has been set to 1.

{lhs}			{rhs}
--------		-----------------------------
<Leader>r		<Plug>(quickrun)



==============================================================================
OPTIONS					*quickrun-options*

Here are the list of options you can specify at command-line.
|g:quickrun_config| is used for options which are not specified.
See |quickrun-syntax-option| for options with (*).

type					*quickrun-option-type*
			Template for current setting.
			Default value is 'filetype',
			See |g:quickrun_config| for more details.

exec (*)				*quickrun-option-exec*
			Format of executed commands.
			You can specify multiple values.
			See |g:quickrun_config| for more details.

command					*quickrun-option-command*
			String expanded to %c in exec.
			If not specified, same value as type is used.

cmdopt (*)				*quickrun-option-cmdopt*
			String expanded to %o in exec.

src					*quickrun-option-src*
			Executed program.
			Default value is whole lines of editing file.

args (*)				*quickrun-option-args*
			String expanded to %a in exec.

input (*)				*quickrun-option-input*
			Filename to be stdin of program.
			If first character starts with =,
			quickrun treats continued string as input.

outputter				*quickrun-option-outputter*
			Specifies an outputter. See the details in
			|quickrun-outputter|.

runner					*quickrun-option-runner*
			Specifies a runner. See the details in
			|quickrun-runner|.

mode					*quickrun-option-mode*
			This value is one of n, v, o .
			This changes behavior of getting the range text.
			Normally this is automatically set by quickrun.
			But you need to care this value
			when you invoke |:QuickRun| from own key mappings.
			e.g.: >
				nnoremap <silent> <F5> :QuickRun -mode n<CR>
				vnoremap <silent> <F5> :QuickRun -mode v<CR>

output_encode (*)			*quickrun-option-output_encode*
			Encoding conversion filter like "from:to".  ":to" is
			omitable.  In that case, it is interpreted like
			"from:&encoding".
			Default value is "&fileencoding".

shebang					*quickrun-option-shebang*
			If this value is not 0, and if "src"'s first line
			started with "#!", the following string is treated as
			"command".  In this case, "%c" is not escaped.
			See |quickrun-exec-format| about escaping.
			Default value is 1.

tempfile (*)				*quickrun-option-tempfile*
			quickrun makes temporary file to execute part of
			lines.
			This value is template for its filename.
			Temporary file will be removed after execute.
			Default value is "{tempname()}".

shellcmd				*quickrun-option-shellcmd*
			Template of Vim's command which is executed
			if output is ! .
			quickrun substitutes %s with commands generated
			by exec option.
			On MS Windows, default value is
			'silent !"%s" & pause'.  Otherwise '!%s'.

eval					*quickrun-option-eval*
			If this value is not 0, quickrun substitutes src
			embedding to eval_template.

eval_template				*quickrun-option-eval_template*
			Template for eval.
			quickrun substitutes %s with src.


------------------------------------------------------------------------------
OPTION SYNTAX				*quickrun-syntax-option*

Specific options which have (*) have special syntax.
Words which start with @, &, $ are evaluated as register, (Vim's) option,
environment variable, respectively.
You can wrap {} around each word explicitly to clarify its boundary.
e.g.: >
	@a
	&{fileencoding}
	$PATH
	%{expr}
{expr} is evaluated using |eval()|.
If an error occurred, it is replaced by empty string.
If you want to avoid evaluation, you need to escape with \ .


------------------------------------------------------------------------------
FORMAT OF EXEC				*quickrun-exec-format*

This value is format of executed commands.
You can use symbols like the followings.
You can also use same symbols altogether.



Symbol		Result ~
--------	------
%%		%
%c		Command (|quickrun-option-command|)
%o		Command line option (|quickrun-option-cmdopt|)
%s		Source (|quickrun-option-src|)
%a		Script's arguments (|quickrun-option-args|)

%c and %s are symbols that specifies file.  These are escaped by
|shellescape()|.  This can be evaded by using capital letter(%C %S) for the
symbol.
You can use |filename-modifiers| for the symbols.
>
	java %S:r:gs?[/\\]?.?
<
And newline(s) are replaced by a whitespace.

Execute Vim ex command
------------------------
If first character of result of exec is ":",
It is executed as Vim's ex command.
And in this case, symbols to specify file are escaped by |fnameescape()|.

Specify multiple command
------------------------
If you specify multiple exec options to |:QuickRun|,
or specify |List| to exec in |g:quickrun_config|.
quickrun executes them in order.
It is useful when you need to do compile, clean up something.



==============================================================================
SETTINGS					*quickrun-settings*
						*g:quickrun_config*

You can define default values using |g:quickrun_config|.
"Default Value" is |Dictionary| whose key is |quickrun-options| names.
And |g:quickrun_config| is |Dictionary| whose key is {type},
and its value is "Default Value".
{type} is option value given as |quickrun-option-type| from command-line.
If it is not specified, current 'filetype' is used instead.
Special {type} '_' has default values for all unspecified keys by each
"Default value".

Options given by command-line has higher priority than {type} specific
settings.
And {type} specific settings has higher priority than {type} '_' settings.

Default settings				*g:quickrun#default_config*
----------------
|g:quickrun#default_config| has default settings
which has same structure as |g:quickrun_config|.
Default values on |quickrun-options| are actually this value.
Usually you don't have to care this variable.

Buffer-local settings				*b:quickrun_config*
---------------------
You can specify buffer-local settings using |b:quickrun_config|.
You need to specify "Default Value" different from |g:quickrun_config|.
This has higher priority any other settings
without options given by command-line.


Here is the order to have higher priorities.

1. Options given by command-line
2. |b:quickrun_config|
3. |g:quickrun_config|'s {type}
4. |g:quickrun#default_config|'s {type}
5. |g:quickrun_config|'s '_'
6. |g:quickrun#default_config|'s '_'

If you set {type} with 1 or 2, it will be loaded by 3 and 4.
In addition, if you set {type} with 3 or 4, {type} is overwrote and reload the
current (3 or 4) config.  Note infinite loop.


==============================================================================
MODULE					*quickrun-module*

|quickrun| is structured modularly. There are the following kinds of modules.

- runner	(|quickrun-module-runner|)
- outputter	(|quickrun-module-outputter|)

A module sometimes has its specific options. You may specify an option as a
normal option or as a postfix of the module.

Specifying an option as a normal option
--------------------------
A module reads options with the following prioitized order when you specified
an option as a normal option.

1. "{module-type}/{module-name}/{option-name}"
2. "{module-type}/{option-name}"
3. "{option-name}"

For example when you'd like to give "append" option to "outputter/buffer"
module, you can give it by
>
	let b:quickrun_config = {'outputter/buffer/append': 1}
<
or,
>
	:QuickRun -outputter/buffer/append 1
<
Furthermore the following way is also available, whereas if there is a more
prioitized option then that'll be prioitized.
>
	:QuickRun -append 1
<

Specifying an option as a postfix of a module
----------------------
You may give an option when you give a module in command line option. Write an
arbitrary symbol after the module name, and split option values with the
symbol. Specify each options in name=value format.
>
	:QuickRun -outputter buffer:append=1:into=1
<
Some modules only have one single option or have specific order of options
defined in |quickrun-module.config_order|. In this case, you don't have to
give name.
>
	:QuickRun -outputter file:/path/to/file
<
If the value of option is list, it appends the option value.


|quickrun-syntax-option| expands any options before they go to the module.

------------------------------------------------------------------------------
RUNNER						*quickrun-module-runner*

Runner is a module to run a program. The following runners are available by
default. NOTE: Everything except for "system" can be unstable.

- "system"
  Runs by |system()|. This is the default.

- "shell"
  Runs by |:!|. This ignores given outputter.
  Option ~
  {shellcmd}		Default: 'silent !"%s" & pause' for MS Windows
				    Otherwise '!%s'
	The template of the Vim command to run. This replaces %s to the
	command given in exec option.

- "vimproc"
  {Requirement: |vimproc|}
  Runs by |vimproc| in background. This checks if the process completed with
  using |CursorHold| |CursorHoldI| events. If the process completed within 50
  millisecond, it shows the result immediately.
  Option ~
  {updatetime}		Default: 0
	Changes 'updatetime' to the value temporary. Stays same if this is 0.

- "remote"
  {Requirement: |+clientserver|}
  Runs in background and fetches the result by |+clientserver| feature.
  This requires |v:servername| to be set. If Vim doesn't, run it with
  |--servername| option.

  Note that Vim cannot control the process when it doesn't terminate due to
  infinite loop or to wait for input since it runs in background.
  Option ~
  {vimproc}		Default: 0
	Runs by |vimproc| if it's available. You can cancel the process after
	it ran.

- "python"
  {Requirement: |+python|}
  Runs by |python| thread asynchronously.
  WARNING: This is absolutely unstable.
  WARNING: Don't use this on X11. Vim crashes.


------------------------------------------------------------------------------
OUTPUTTER					*quickrun-module-outputter*

Outputter is a module to output the result. The following outputters are
available by default.

- "buffer"
  quickrun opens output buffer and displays to the output buffer.  If output
  buffer already exists, quickrun uses it.  And for customize, quickrun sets
  "quickrun" to 'filetype' of this buffer. This is the default.
  Option ~
  {append}		Default: 0
	Appends if it's 1.
  {split}
	Default: '{winwidth(0) * 2 < winheight(0) * 5 ? "" : "vertical"}'

	Specifies a sub-command to open a buffer for the output. |quickrun|
	inserts this before |:split| command when it opens a buffer.
  {into}		Default: 0
	Moves cursor to the output buffer if this isn't 0.
  {running_mark}	Default: ':-)'
	If this value is not an empty string, |quickrun| displays this string
	to output buffer while it's running.

- "message"
  Outputs on |messages|.
  Option ~
  {log}			Default: 0
	Outputs on |message-history| is it's 1.

- "variable"
  Outputs on a variable. You also can let it output on an environment variable
  or an option.
  Option ~
  {name}		Default: ''
	The name of the variable to output. Causes an error if it's empty.
  {append}		Default: 0
	Appends if it's 1.

- "file"
  Outputs on a file.
  Option ~
  {name}		Default: ''
	The file name where to output. Causea an error if it's empty.
  {append}		Default: 0
	Appends if it's 1.

- "quickfix"
  Outputs on |quickfix|.
  Option ~
  {errorformat}		Default: "&errorformat"
	'errorformat' option to parse the output.

- "browser"
  {Requires |open-browser|}
  Opens the output on browser, using |open-browser|.
  Option ~
  {name}		Default: tempname() . '.html'
	The name of the filename; outputs the result on a file first then open
	the file on your browser. The default value, |tempname()|, is called
	only at once and the same result will be used since the second time.
  {append}		Default: 0
	Appends if it's 1.

- "buffered"
  Buffers the output, and shows the whole result at once finally.
  Option ~
  {target}		Default: ''
	The outputter to show the result.

- "multi"
  Outputs multiple outputters at the same time.
  Option ~
  {targets}		Default: []
	A list of outputters to output.

- "error"
  Switches where to output based on the exit status; 0 means success. Note that
  some runners only can give success.
  This buffers because this waits the process terminates.
  Option ~
  {success}		Default: "null"
	The outputter when it succeeded.
  {error}		Default: "null"
	The outputter when it failed.

- "null"
  No outputs.



==============================================================================
CREATE MODULE				*quickrun-create-module*

A module is just a dictionary(|Dictionary|) that has specific attributes,
what's the problem? You can use the module after registering it.

------------------------------------------------------------------------------
REGISTER MODULE				*quickrun-register-module*

You use a module with registering by |quickrun#register_module()| or its
handier version |quickrun#register_runner()| and
|quickrun#register_outputter()|. You can also register a module automatically
by making autoload#quickrun#{module-kind}#{module-name}#new() function in
autoload/quickrun/{module-kind}/{module-name}.vim in 'runtimepath'. That'll be
loaded when quickrun is loaded for the first time in the process.

------------------------------------------------------------------------------
SESSION				*quickrun-session*

NOTE: This section is not translated yet.

quickrun では 1 回の実行をセッション({session})として管理しており、モジュール
の各関数に引数として渡されます。

session.make_module({kind}, {line})	*quickrun-session.make_module()*
	セッション中で使えるようにモジュールを生成します。

session.output({data})			*quickrun-session.output()*
	runner が出力を行う際に呼び出します。{data} はその場で outputter へ渡
	されます。実行中は何度呼び出しても問題ありません。

session.continue()			*quickrun-session.continue()*
	runner がその場で実行を完了できない時に呼び出します。{key} を返しま
	す。|quickrun#session()| に {key} を渡すことで、実行を継続します。

session.finish([{exit-code}])		*quickrun-session.finish()*
	runner が実行が全て完了した際に呼び出します。{exit-code} が省略された
	場合は 0 になります。

session.exit_code			*quickrun-session.exit_code*
	実行が完了した後にのみ参照できます。|quickrun-session.finish()| で渡さ
	れた値です。

session.sweep()				*quickrun-session.sweep()*
	セッションの後始末を行います。セッションに対して以下の属性が設定されて
	いた場合、それに応じた処理が行われます。
	- "_temp_" で始まる属性があった場合、その値をファイル名としてファイル
	  を削除します。
	- "_option_{option-name}" という属性があった場合、オプションの値を復元
	  します。
	- "_autocmd_" で始まる属性があった場合、"plugin-quickrun-{value}" とい
	  う名前のグループに属する autocmd を全て削除します。
	- "_vimproc" という属性があった場合、その |vimproc| を強制終了します。
	また、|quickrun-runner.sweep()| を呼び出します。
	これらは便利ですが、今のところ複数のモジュールから使われた際の名前の衝
	突が考慮されていません。これは将来改善される可能性があります。

------------------------------------------------------------------------------
MODULE COMMON ATTRIBUTES				*quickrun-module-attributes*

NOTE: This section is not translated yet.

モジュールの属性の多くはデフォルト値があり、必須と明記されている属性以外は明示
的に設定する必要はありません。ただし、必要に応じてデフォルト値を上書きすること
ができます。
モジュールが実際に使われる際は、登録したモジュールのコピーが使われます。セッ
ション中にモジュール毎に値を保持したい場合は、既存の属性との衝突を避けるために
"_" で始まる属性を使用してください。
以下は全モジュールで共通の属性です。

module.config				*quickrun-module.config*
	これは辞書で、このモジュールが取る config のデフォルト値です。ここで定
	義されているものだけが、モジュールで有効なコンフィグとなります。
	モジュールを実際に使う際には、セッションによって設定が上書きされます。

module.config_order			*quickrun-module.config_order*
	これはリストで、config の引数の順序です。|quickrun-module.config| で指
	定されている名前を任意の順序で並べます。

module.available()			*quickrun-module.available()*
	|quickrun-module.validate()| を使ってこのモジュールが利用可能かを調べ
	ます。利用可能なら 1、そうでなければ 0 を返します。

module.validate()			*quickrun-module.validate()*
	モジュールが利用可能な状況にあるかを検証します。利用できない場合は、そ
	の理由となる文字列を |:throw| します。

module.init({session})			*quickrun-module.init()*
	モジュールの初期化時に呼び出されます。

------------------------------------------------------------------------------
RUNNER ATTRIBUTES				*quickrun-runner-attributes*

NOTE: This section is not translated yet.

runner.run({commands}, {input}, {session})	*quickrun-runner.run()*
	必須です。実行時に呼び出されます。{commands} で渡されたコマンドのリス
	トを実行 し、{exit-code} を返します。{input} は標準入力データです。
	その場で実行を完了できない時は、|quickrun-session.continue()| を使いま
	す。その場合、|quickrun-session.finish()| を呼び出す必要があります。

runner.sweep()				*quickrun-runner.sweep()*
	実行の完了、もしくは強制終了時に呼び出されます。実行中のデータの後始末
	を行います。

------------------------------------------------------------------------------
OUTPUTTER ATTRIBUTES			*quickrun-outputter-attributes*

outputter.output({data}, {session})	*quickrun-outputter.output()*
	Required. Outputs the data.

outputter.finish({session})		*quickrun-outputter.finish()*
	Called in termination for finishing it. You can refer
	|quickrun-session.exit_code|.



==============================================================================
CHANGELOG					*quickrun-changelog*

See Japanese help or git-log.

==============================================================================
vim:tw=78:fo=tcq2mM:ts=8:ft=help:norl
